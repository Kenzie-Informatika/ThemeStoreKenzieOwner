<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kenzie Owner | Ultimate Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root { --p: #6366f1; }
        .active-menu { background: rgba(99, 102, 241, 0.15); color: var(--p) !important; border-right: 4px solid var(--p); }
        body { transition: 0.3s ease; }
        .page-anim { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body id="mainBody" class="bg-[#0f172a] text-slate-200 flex h-screen overflow-hidden">

    <aside id="sidebar" class="w-72 border-r border-slate-800 flex flex-col py-8 bg-[#0f172a]">
        <div class="px-8 mb-10">
            <h1 class="font-black text-xl tracking-tight">OWNER<span class="text-indigo-500">CONTROL</span></h1>
            <a href="index.html" class="text-[10px] text-indigo-400 font-bold hover:underline cursor-pointer"><i class="ri-external-link-line"></i> LIHAT WEB STORE</a>
        </div>

        <nav class="flex-1 px-4 space-y-2">
            <button onclick="navTo('upload', this)" class="menu-btn active-menu w-full flex items-center gap-4 p-4 rounded-xl text-slate-400 font-bold transition-all">
                <i class="ri-add-circle-line text-xl"></i> Tambah Proyek
            </button>
            <button onclick="navTo('list', this)" class="menu-btn w-full flex items-center gap-4 p-4 rounded-xl text-slate-400 font-bold transition-all">
                <i class="ri-folder-open-line text-xl"></i> List Proyek Kita
            </button>
        </nav>

        <div class="px-8 mt-auto">
            <div class="p-4 bg-slate-800/30 rounded-2xl border border-slate-700/50">
                <p class="text-[10px] font-black text-slate-500 uppercase">User Aktif</p>
                <p class="text-sm font-bold">Kenzie Developer</p>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="h-20 border-b border-slate-800 flex items-center justify-between px-10">
            <h2 id="headerTitle" class="text-lg font-bold">Tambah Proyek Baru</h2>
        </header>

        <div class="flex-1 overflow-y-auto p-10">
            <section id="section-upload" class="page-anim space-y-8">
                <div class="bg-slate-800/40 p-10 rounded-[2.5rem] border border-slate-700 max-w-2xl mx-auto shadow-2xl">
                    <div class="space-y-6">
                        <input type="text" id="itemName" placeholder="Nama..." class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-700 outline-none focus:ring-2 ring-indigo-500 text-white">
                        <input type="file" id="fileInput" class="hidden" onchange="fileSelected()">
                        <label for="fileInput" class="cursor-pointer border-2 border-dashed border-slate-700 rounded-3xl p-10 flex flex-col items-center justify-center hover:border-indigo-500 transition">
                            <i class="ri-upload-cloud-2-line text-5xl text-slate-600 mb-2"></i>
                            <span id="fileStatus" class="text-sm font-bold text-slate-500 uppercase">Pilih File Project</span>
                        </label>
                        <select id="itemCat" class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-700 outline-none text-white">
                            <option value="wallpaper">Wallpaper HD</option>
                            <option value="theme">Widget / Theme</option>
                        </select>
                        <div id="progBarCont" class="hidden bg-slate-900 h-2 rounded-full overflow-hidden">
                            <div id="progBar" class="bg-indigo-500 h-full w-0 transition-all"></div>
                        </div>
                        <button onclick="doUpload()" id="btnUp" class="w-full bg-indigo-600 py-4 rounded-2xl font-black text-white hover:bg-indigo-500 transition">UPLOAD SEKARANG</button>
                    </div>
                </div>
            </section>

            <section id="section-list" class="page-anim hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </section>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDAhN_BxC9c76kB2jzTJ05F0NXX9ZjRYqQ",
            authDomain: "themestorekenzie.firebaseapp.com",
            projectId: "themestorekenzie",
            storageBucket: "themestorekenzie.firebasestorage.app",
            messagingSenderId: "220524638997",
            appId: "1:220524638997:web:a7d4860fb6d2b179a9af1c",
            measurementId: "G-WTR3T92KWS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        window.navTo = (page, btn) => {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('section-' + page).classList.remove('hidden');
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active-menu'));
            btn.classList.add('active-menu');
        };

        window.fileSelected = () => {
            const f = document.getElementById('fileInput').files[0];
            if(f) document.getElementById('fileStatus').innerText = f.name;
        };

        window.doUpload = async () => {
            const name = document.getElementById('itemName').value;
            const file = document.getElementById('fileInput').files[0];
            const cat = document.getElementById('itemCat').value;
            if(!name || !file) return alert("Lengkapi data!");

            document.getElementById('progBarCont').classList.remove('hidden');
            const sRef = ref(storage, 'projects/' + Date.now() + "_" + file.name);
            const task = uploadBytesResumable(sRef, file);

            task.on('state_changed', 
                (s) => { document.getElementById('progBar').style.width = (s.bytesTransferred / s.totalBytes) * 100 + '%'; },
                (e) => alert(e.message),
                () => {
                    getDownloadURL(task.snapshot.ref).then(async (url) => {
                        await addDoc(collection(db, "assets"), { title: name, url: url, type: cat, path: sRef.fullPath, createdAt: Date.now() });
                        alert("Berhasil!"); location.reload();
                    });
                }
            );
        };

        onSnapshot(query(collection(db, "assets"), orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('section-list');
            list.innerHTML = '';
            snap.forEach(d => {
                const item = d.data();
                list.innerHTML += `
                    <div class="bg-slate-800/50 rounded-3xl p-5 border border-slate-700">
                        <img src="${item.url}" class="w-full h-32 object-cover rounded-xl mb-3">
                        <p class="font-bold text-sm truncate">${item.title}</p>
                        <button onclick="hapus('${d.id}', '${item.path}')" class="w-full mt-3 py-2 bg-red-500/10 text-red-500 rounded-lg text-xs font-bold">HAPUS</button>
                    </div>`;
            });
        });

        window.hapus = async (id, path) => {
            if(confirm("Hapus?")) {
                await deleteDoc(doc(db, "assets", id));
                try { await deleteObject(ref(storage, path)); } catch(e) {}
            }
        };
    </script>
</body>
</html>
